/* * *******************************************************************************
* This file is part of SpiceCRM FulltextSearch. SpiceCRM FulltextSearch is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the SpiceCRM FulltextSearch is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@spicecrm.io
******************************************************************************* */

Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.model.authtype",{extend:"Ext.data.Model",fields:["id","bean","status","usagecount"]}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.model.authtypeaction",{extend:"Ext.data.Model",fields:["id","action","shortcode"]}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.model.authtypefield",{extend:"Ext.data.Model",fields:["id","name"]}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.model.field",{extend:"Ext.data.Model",fields:["name"]}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.model.module",{extend:"Ext.data.Model",fields:["name"]}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.store.authtypeactions",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthTypeManager.model.authtypeaction"],model:"SpiceCRM.KAuthManager.AuthTypeManager.model.authtypeaction",alias:"store.KAuthManager.authtypeactions",autoLoad:!0,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authtypeactions",appendId:!0,reader:{type:"json"},writer:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.store.authtypefields",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthTypeManager.model.authtypefield"],model:"SpiceCRM.KAuthManager.AuthTypeManager.model.authtypefield",alias:"store.KAuthManager.authtypefields",autoLoad:!1,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authtypefields",appendId:!0,reader:{type:"json"},writer:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.store.authtypes",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthTypeManager.model.authtype"],model:"SpiceCRM.KAuthManager.AuthTypeManager.model.authtype",alias:"store.KAuthManager.authtypes",autoLoad:!0,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authtypes",appendId:!0,reader:{type:"json"},writer:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.store.fields",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthTypeManager.model.field"],model:"SpiceCRM.KAuthManager.AuthTypeManager.model.field",alias:"store.KAuthManager.fields",autoLoad:!1,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authtypefields/fields",appendId:!0,reader:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.store.modules",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthTypeManager.model.module"],model:"SpiceCRM.KAuthManager.AuthTypeManager.model.module",alias:"store.KAuthManager.modules",autoLoad:!0,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authtypes/modules",appendId:!0,reader:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.controller.Application",{extend:"Ext.app.Controller",config:{listen:{global:{}}},doInit:function(){},finishInit:function(){},onLaunch:function(){}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.controller.AuthTypeDetailsController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthTypeDetailsController",currentRecord:void 0,config:{listen:{global:{AuthTypeSelected:function(a){this.currentRecord=a;var b=this.view.down("#authtypefields").getStore();b.removeAll(),b.getProxy().extraParams.authType=a.id,b.load();var c=this.view.down("#authtypeactions").getStore();c.removeAll(),c.getProxy().extraParams.authType=a.id,c.load()}}},control:{"#":{},"#authTypeAddFieldButton":{click:function(){this.currentRecord&&Ext.create("SpiceCRM.KAuthManager.AuthTypeManager.window.addfieldwindow",{currentRecord:this.currentRecord}).show()}},"#authTypeDeleteFieldButton":{click:function(a){var b=this.view.down("#authtypefields").getSelection();Ext.each(b,function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authtypefields/"+a.id,method:"DELETE",success:function(b,c){Ext.data.StoreManager.lookup("KAuthManager.authtypefields").remove(a)},failure:function(a,b){},scope:this})})}},"#authTypeAddActionButton":{click:function(){this.currentRecord&&Ext.Msg.prompt("Add Action","new action",function(a,b){if("ok"==a){var c={id:SpiceCRM.KAuthManager.AuthTypeManager.Application.kGuid(),kauthtype_id:this.currentRecord.id,action:b};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authtypeactions",method:"POST",jsonData:Ext.encode(c),success:function(a,b){Ext.data.StoreManager.lookup("KAuthManager.authtypeactions").add(c),this.up(".window").close()},failure:function(a,b){},scope:this})}},this)}},"#authTypetDeleteActionButton":{click:function(){var a=this.view.down("#authtypeactions").getSelection();Ext.each(a,function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authtypeactions/"+a.id,method:"DELETE",success:function(b,c){Ext.data.StoreManager.lookup("KAuthManager.authtypeactions").remove(a)},failure:function(a,b){},scope:this})})}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.controller.AuthTypesController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthTypesController",config:{listen:{global:{}},control:{"#":{select:function(){var a=this.view.getSelection();Ext.globalEvents.fireEvent("AuthTypeSelected",a[0]),a[0].get("usagecount")>0?this.view.down("#authTypetDeleteButton").disable():this.view.down("#authTypetDeleteButton").enable()}},"#authTypeAddButton":{click:function(){Ext.create("SpiceCRM.KAuthManager.AuthTypeManager.window.addmodulewindow").show()}},"#authTypetDeleteButton":{click:function(){var a=this.view.getSelection();Ext.each(a,function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authtypes/"+a.id,method:"DELETE",success:function(b,c){Ext.data.StoreManager.lookup("KAuthManager.authtypes").remove(a)},failure:function(a,b){},scope:this})})}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.controller.MainController",{extend:"Ext.app.ViewController",requires:[],saving:!1,alias:"controller.AuthTypeManager.main",loadMask:void 0,config:{listen:{global:{}}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.window.addfieldwindow",{extend:"Ext.window.Window",title:"Add Field",layout:"fit",width:500,height:300,closeAction:"close",plain:!0,draggable:!0,modal:!0,currentRecord:void 0,items:[{xtype:"grid",itemId:"fieldGrid",store:{type:"KAuthManager.fields"},columns:[{text:"name",dataIndex:"name",flex:1,sortable:!0}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"displayfield",itemId:"messagecontainer"},"->",{text:"Cancel",handler:function(){this.up(".window").close()}},{text:"Add",handler:function(a){var b=a.up("window").down("grid"),c=b.getSelection();if(c.length>0){var d={id:SpiceCRM.KAuthManager.AuthTypeManager.Application.kGuid(),kauthtype_id:this.up("window").currentRecord.id,name:c[0].get("name")};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authtypefields",method:"POST",jsonData:Ext.encode(d),success:function(a,b){Ext.data.StoreManager.lookup("KAuthManager.authtypefields").add(d),this.up(".window").close()},failure:function(a,b){},scope:this})}else a.up("window").down("#messagecontainer").setValue("no field selected")}}]}],listeners:{show:function(){var a=this.down("#fieldGrid").getStore();a.removeAll(),a.getProxy().extraParams.authtypemodule=this.currentRecord.get("bean"),a.getProxy().extraParams.authtypeid=this.currentRecord.get("id"),a.load()}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.window.addmodulewindow",{extend:"Ext.window.Window",title:"Add Module",layout:"fit",width:500,closeAction:"close",plain:!0,draggable:!0,modal:!0,items:[{xtype:"fieldset",defaults:{width:"100%"},items:[{xtype:"combo",fieldLabel:"module",itemId:"moduleCombo",typeAhead:!0,triggerAction:"all",queryMode:"local",editable:!0,store:{type:"KAuthManager.modules"},displayField:"name",valueField:"name"}]}],buttons:[{text:"Cancel",handler:function(){this.up(".window").close()}},{text:"Add",handler:function(a){var b={id:SpiceCRM.KAuthManager.AuthTypeManager.Application.kGuid(),bean:a.up("window").down("#moduleCombo").getValue()};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authtypes",method:"POST",jsonData:Ext.encode(b),success:function(a,c){Ext.data.StoreManager.lookup("KAuthManager.authtypes").add(b),this.up(".window").close()},failure:function(a,b){},scope:this})}}],listeners:{show:function(){}}}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.view.AuthTypeDetails",{extend:"Ext.panel.Panel",alias:"widget.KAuthManager.AuthTypeDetails",requires:["SpiceCRM.KAuthManager.AuthTypeManager.controller.AuthTypeDetailsController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthTypeDetailsController",layout:"vbox",style:{"background-color":"transparent"},items:[{xtype:"grid",title:"fields",itemId:"authtypefields",store:{type:"KAuthManager.authtypefields",storeId:"KAuthManager.authtypefields"},columns:[{text:"name",dataIndex:"name",flex:1,sortable:!0}],width:"100%",flex:1,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"authTypeAddFieldButton",icon:"modules/KOrgObjects/images/add.png",text:"add"},{xtype:"button",itemId:"authTypeDeleteFieldButton",icon:"modules/KOrgObjects/images/delete.png",text:"delete"}]}]},{xtype:"grid",title:"Actions",width:"100%",itemId:"authtypeactions",store:{type:"KAuthManager.authtypeactions",storeId:"KAuthManager.authtypeactions"},columns:[{text:"action",dataIndex:"action",flex:1,sortable:!0}],flex:1,dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"authTypeAddActionButton",icon:"modules/KOrgObjects/images/add.png",text:"add"},{xtype:"button",itemId:"authTypetDeleteActionButton",icon:"modules/KOrgObjects/images/delete.png",text:"delete"}]}]}]}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.view.AuthTypes",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthTypes",requires:["SpiceCRM.KAuthManager.AuthTypeManager.controller.AuthTypesController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthTypesController",layout:"fit",title:"modules",style:{"background-color":"transparent"},store:Ext.create("SpiceCRM.KAuthManager.AuthTypeManager.store.authtypes",{storeId:"KAuthManager.authtypes"}),columns:[{text:"name",dataIndex:"bean",flex:1,sortable:!0},{text:"#",dataIndex:"usagecount",width:30,renderer:function(a){return a>0?'<img src="modules/KAuthProfiles/images/lock.png"/>':'<img src="modules/KAuthProfiles/images/unlock.png"/>'}}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"authTypeAddButton",icon:"modules/KOrgObjects/images/add.png",text:"add"},{xtype:"button",itemId:"authTypetDeleteButton",disabled:!0,icon:"modules/KOrgObjects/images/delete.png",text:"delete"}]},{xtype:"pagingtoolbar",store:"KAuthManager.authtypes",dock:"bottom",displayInfo:!0}]}),Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.view.main.Main",{extend:"Ext.panel.Panel",requires:["SpiceCRM.KAuthManager.AuthTypeManager.controller.MainController"],xtype:"app-main",renderTo:"authtypemanager",height:"100%",width:"100%",border:!1,controller:"AuthTypeManager.main",layout:"fit",titel:"Auith Types",style:{"background-color":"transparent"},items:[{xtype:"panel",layout:"hbox",width:"100%",items:[{xtype:"KAuthManager.AuthTypes",height:"100%",flex:1},{xtype:"KAuthManager.AuthTypeDetails",height:"100%",flex:1}]}]}),Ext.enableAriaButtons=!1,Ext.define("SpiceCRM.KAuthManager.AuthTypeManager.Application",{namespaces:["SpiceCRM.KAuthManager.AuthTypeManager"],controllers:["Application"],extend:"Ext.app.Application",name:"SpiceCRM.KAuthManager.AuthTypeManager",thisMainView:!1,launch:function(){SpiceCRM.KAuthManager.AuthTypeManager.Application=this,this.thisMainView&&this.destroyMainView(),this.render()},destroyMainView:function(){this.thisMainView.destroy(),this.thisMainView=!1},render:function(){this.thisMainView=Ext.create("SpiceCRM.KAuthManager.AuthTypeManager.view.main.Main"),Ext.get(window).on({resize:function(){SpiceCRM.KAuthManager.AuthTypeManager.Application.thisMainView&&SpiceCRM.KAuthManager.AuthTypeManager.Application.thisMainView.updateLayout()}})},languageGetText:function(a){return SUGAR.language.get("KAuthProfiles",a)},getRand:function(){return Math.random()},S4:function(){return(65536*(1+this.getRand())|0).toString(16).substring(1)},kGuid:function(){return"k"+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()}}),Ext.application({extend:"SpiceCRM.KAuthManager.AuthTypeManager.Application"});