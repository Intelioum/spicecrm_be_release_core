/* * *******************************************************************************
* This file is part of SpiceCRM FulltextSearch. SpiceCRM FulltextSearch is an enhancement developed
* by aac services k.s.. All rights are (c) 2016 by aac services k.s.
*
* This Version of the SpiceCRM FulltextSearch is licensed software and may only be used in
* alignment with the License Agreement received with this Software.
* This Software is copyrighted and may not be further distributed without
* witten consent of aac services k.s.
*
* You can contact us at info@spicecrm.io
******************************************************************************* */

Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authassignmentuser",{extend:"Ext.data.Model",fields:["id","user_name","first_name","last_name"]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authobject",{extend:"Ext.data.Model",fields:["id","name","status","customSQL","description","usagecount","kauthobjecttype","activity"],proxy:{type:"rest",url:"KREST/kauthprofiles/core/authobjects",reader:{type:"json"},writer:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectfieldcontrol",{extend:"Ext.data.Model",fields:["kauthobject_id","field","control"]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectfieldvalue",{extend:"Ext.data.Model",fields:["id","name","operator","value1","value2"]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectorgvalue",{extend:"Ext.data.Model",fields:["id","name","value","displayvalue"]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authprofile",{extend:"Ext.data.Model",fields:["id","name","status","usagecount"],proxy:{type:"rest",url:"KREST/kauthprofiles/core/authprofiles",reader:{type:"json"},writer:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authprofileobject",{extend:"Ext.data.Model",fields:["id","name","status","bean"]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.authtype",{extend:"Ext.data.Model",fields:["id","bean"]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.model.field",{extend:"Ext.data.Model",fields:["name"]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authassignmentusers",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authassignmentuser"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authassignmentuser",alias:"store.KAuthManager.authassignmentuser",autoLoad:!0,pageSize:25,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authusers",reader:{type:"json",rootProperty:"records",totalProperty:"totalcount"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjectfieldcontrols",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectfieldcontrol"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectfieldcontrol",alias:"store.KAuthManager.authobjectfieldcontrols",autoLoad:!1,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authobjects/fieldcontrols",reader:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjectfieldvalues",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectfieldvalue"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectfieldvalue",alias:"store.KAuthManager.authobjectorgvalues",autoLoad:!1,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authobjects/fieldvalues",reader:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjectorgvalues",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectorgvalue"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authobjectorgvalue",alias:"store.KAuthManager.authobjectorgvalues",autoLoad:!1,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authobjects/orgvalues",reader:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjects",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authobject"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authobject",alias:"store.KAuthManager.authobjects",autoLoad:!1,pageSize:25,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authobjects",reader:{type:"json",rootProperty:"records",totalProperty:"totalcount"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authprofileobjects",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authprofileobject"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authprofileobject",alias:"store.KAuthManager.authprofileobjects",autoLoad:!1,proxy:{type:"memory"}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authprofiles",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authprofile"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authprofile",alias:"store.KAuthManager.authprofiles",autoLoad:!0,pageSize:25,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authprofiles",reader:{type:"json",rootProperty:"records",totalProperty:"totalcount"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.authtypes",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.authtype"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.authtype",alias:"store.KAuthManager.authtypes",autoLoad:!0,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authtypes",appendId:!0,reader:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.store.fields",{extend:"Ext.data.Store",requires:["SpiceCRM.KAuthManager.AuthProfileManager.model.field"],model:"SpiceCRM.KAuthManager.AuthProfileManager.model.field",alias:"store.AuthProfileManager.fields",autoLoad:!1,proxy:{type:"rest",url:"KREST/kauthprofiles/core/authobjects/fieldcontrol/fields",appendId:!0,reader:{type:"json"}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.Application",{extend:"Ext.app.Controller",doInit:function(){},finishInit:function(){},onLaunch:function(){}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthAssignmentProfilesController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthAssignmentProfilesController",currentUserId:void 0,config:{listen:{global:{AuthProfileManagerUserDataRetrieved:function(a,b){this.view.down("#authProfileAddButton").enable(),this.view.down("#authProfileDeleteButton").disable(),this.currentUserId=a,this.view.getStore().removeAll(),this.view.getStore().add(b)}}},control:{"#":{select:function(a,b){this.view.down("#authProfileDeleteButton").enable()}},"#authProfileAddButton":{click:function(){Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.window.addprofilewindow",{currentUserId:this.currentUserId}).show()}},"#authProfileDeleteButton":{click:function(){Ext.each(this.view.getSelection(),function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authusers/"+this.currentUserId+"/authprofiles/"+a.get("id"),method:"DELETE",success:function(b,c){this.view.getStore().remove(a)},failure:function(a,b){},scope:this})},this)}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthAssignmentUsersController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthAssignmentUsersController",config:{listen:{global:{}},control:{"#":{select:function(a,b){this.view.up("#AuthProfileManagerPanel").showLoadMask(),Ext.Ajax.request({url:"KREST/kauthprofiles/core/authusers/"+b.id+"/authprofiles",method:"GET",success:function(a,c){var d=Ext.decode(a.responseText);Ext.globalEvents.fireEventArgs("AuthProfileManagerUserDataRetrieved",[b.id,d]),this.view.up("#AuthProfileManagerPanel").hideLoadMask()},failure:function(a,b){this.view.up("#AuthProfileManagerPanel").hideLoadMask()},scope:this})}},"#userFilter":{keyup:function(a,b){b.getKey()==b.ENTER&&(this.view.getStore().getProxy().extraParams.searchterm=a.getValue(),this.view.down("pagingtoolbar").moveFirst())}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectFieldControlsController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthObjectFieldControlsController",currentRecordId:void 0,config:{listen:{global:{AuthProfileManagerElementAuthFieldData:function(a){this.view.enable(),this.view.getStore().removeAll(),this.currentRecordId=void 0},AuthProfileManagerObjectDataRetrieved:function(a){this.view.getStore().removeAll(),this.currentRecordId=a.object.id,a.fieldcontrols&&this.view.getStore().add(a.fieldcontrols)}}},control:{"#":{edit:function(a,b){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authobjects/fieldcontrol",method:"PUT",jsonData:Ext.encode(b.record.data),scope:this})}},"#authObjectFieldControlAddButton":{click:function(){this.currentRecordId&&Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.window.addfieldwindow",{currentRecordId:this.currentRecordId}).show()}},"#authObjectFieldControlDeleteButton":{click:function(){var a=this.view.getSelection();Ext.each(a,function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authobjects/fieldcontrol",method:"DELETE",jsonData:Ext.encode(a.data),success:function(){this.view.getStore().remove(a)},scope:this})},this)}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectFieldValuesController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthObjectFieldValuesController",config:{listen:{global:{AuthProfileManagerElementAuthFieldData:function(a){this.view.getStore().removeAll(),a&&Ext.each(a,function(a){this.view.getStore().add(a)},this)},AuthProfileManagerObjectDataRetrieved:function(a){this.view.store.each(function(a){a.set({operator:"",value1:"",value2:""})},this),a.fieldvalues&&Ext.each(a.fieldvalues,function(a){var b=this.view.getStore().getById(a.kauthtypefield_id);b&&b.set({operator:a.operator,value1:a.value1,value2:a.value2})},this)}}},control:{}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectOrgValuesController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthObjectOrgValuesController",currentRecordId:void 0,config:{listen:{global:{AuthProfileManagerElementOrgData:function(a){this.view.getStore().removeAll(),this.view.disable(),a&&Ext.each(a.orgelements,function(a){this.view.getStore().add(a)},this)},AuthProfileManagerObjectDataRetrieved:function(a){this.currentRecordId=a.object.id,this.view.store.each(function(a){a.set({value:"",displayvalue:""})},this),this.view.getStore().getCount()>0?(Ext.each(a.orgvalues,function(a){var b=this.view.getStore().getById(a.korgobjectelement_id);b&&b.set({value:a.value,displayvalue:a.displayvalue})},this),this.view.down("#orgAssignment").setValue(a.object.kauthorgassignment),this.view.down("#orgAssignment").enable()):(this.view.down("#orgAssignment").setValue("3"),this.view.down("#orgAssignment").disable()),this.view.down("#assignedUser").setValue(a.object.kauthowner),"r"===a.object.status?this.view.disable():this.view.enable()},AuthObjectStatusChange:function(a){"r"===a.get("status")?this.view.disable():this.view.enable()}}},control:{"#":{edit:function(a,b){var c=[];this.view.getStore().each(function(a){c.push(a.data)}),Ext.Ajax.request({url:"KREST/kauthprofiles/core/authobjects/orgvalues/"+this.currentRecordId,method:"POST",jsonData:Ext.encode(c),success:function(a,b){},failure:function(a,b){},scope:this})}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectsController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthObjectsController",currentAuthType:null,config:{listen:{global:{}},control:{"#":{select:function(a,b){this.view.up("#AuthProfileManagerPanel").showLoadMask(),Ext.Ajax.request({url:"KREST/kauthprofiles/core/authobjects/"+b.id,method:"GET",success:function(a,b){var c=Ext.decode(a.responseText);Ext.globalEvents.fireEvent("AuthProfileManagerObjectDataRetrieved",c),"r"!==c.object.status?(this.view.down("#authObjectDeleteButton").enable(),this.view.down("#authObjectActivateButton").setIcon("modules/KAuthProfiles/images/bulb_on.png"),this.view.down("#authObjectActivateButton").setTooltip("Activate Object")):(this.view.down("#authObjectDeleteButton").disable(),this.view.down("#authObjectActivateButton").setIcon("modules/KAuthProfiles/images/bulb_off.png"),this.view.down("#authObjectActivateButton").setTooltip("Dectivate Object")),this.view.up("#AuthProfileManagerPanel").hideLoadMask()},failure:function(a,b){this.view.up("#AuthProfileManagerPanel").hideLoadMask()},scope:this})},edit:function(a,b){b.record.save()}},"#authTypeCombo":{select:function(a,b){this.view.up("#AuthProfileManagerPanel").showLoadMask(),this.currentAuthType=b.id,this.view.getStore().removeAll(),this.view.getStore().getProxy().extraParams.kauthtypeid=b.id,this.view.getStore().load(),Ext.Ajax.request({url:"KREST/kauthprofiles/core/authtypes/"+b.id,method:"GET",success:function(a,b){var c=Ext.decode(a.responseText);Ext.globalEvents.fireEvent("AuthProfileManagerElementOrgData",c.orgtype),Ext.globalEvents.fireEvent("AuthProfileManagerElementAuthFieldData",c.authtypefields),this.view.up("#AuthProfileManagerPanel").hideLoadMask()},failure:function(a,b){this.view.up("#AuthProfileManagerPanel").hideLoadMask()},scope:this})}},"#objectFilter":{keyup:function(a,b){b.getKey()==b.ENTER&&(this.view.getStore().getProxy().extraParams.searchterm=a.getValue(),this.view.down("pagingtoolbar").moveFirst())}},"#authObjectActivateButton":{click:function(){this.view.up("#AuthProfileManagerPanel").showLoadMask();var a=this.view.getSelection();Ext.each(a,function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authobjects/"+a.id+("r"===a.get("status")?"/deactivate":"/activate"),method:"POST",success:function(b,c){a.set("status","r"===a.get("status")?"d":"r"),Ext.globalEvents.fireEvent("AuthObjectStatusChange",a),this.view.up("#AuthProfileManagerPanel").hideLoadMask()},failure:function(a,b){this.view.up("#AuthProfileManagerPanel").hideLoadMask()},scope:this})},this)}},"#authObjectAddButton":{click:function(){Ext.Msg.prompt("Add Object","Name of new Object:",function(a,b){if("ok"==a){var c={id:SpiceCRM.KAuthManager.AuthProfileManager.Application.kGuid(),kauthtype_id:this.currentAuthType,name:b,status:"d",kauthobjecttype:0,kauthorgassignment:0,kauthowner:0,allorgobjects:0,activitiy:0};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authobjects/"+c.id,method:"POST",jsonData:Ext.encode(c),success:function(a,b){var d=this.view.getStore().add(c);this.view.getStore().sort("name","ASC"),this.view.setSelection(d)},failure:function(a,b){},scope:this})}},this)}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthProfileObjectsController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthProfileObjectsController",currentProfileRecord:void 0,config:{listen:{global:{AuthProfileSelected:function(a){this.currentProfileRecord=a,this.view.getStore().removeAll(),Ext.Ajax.request({url:"KREST/kauthprofiles/core/authprofiles/"+a.id+"/authobjects",method:"GET",success:function(a,b){var c=Ext.decode(a.responseText);this.view.getStore().add(c)},failure:function(a,b){},scope:this}),this.view.down("#authProfileObjectDeleteButton").disable(),"r"==a.get("status")?this.view.down("#authProfilObjectAddButton").disable():this.view.down("#authProfilObjectAddButton").enable()},AuthProfileDeleted:function(){this.view.getStore().removeAll(),this.view.down("#authProfileObjectDeleteButton").disable()}}},control:{"#":{select:function(a,b){"r"!==this.currentProfileRecord.get("status")&&this.view.down("#authProfileObjectDeleteButton").enable()}},"#authProfilObjectAddButton":{click:function(){Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.window.addobjectwindow",{currentRecordId:this.currentProfileRecord.id}).show()}},"#authProfileObjectDeleteButton":{click:function(){Ext.each(this.view.getSelection(),function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authprofiles/"+this.currentProfileRecord.id+"/authobjects/"+a.get("id"),method:"DELETE",success:function(b,c){this.view.getStore().remove(a)},failure:function(a,b){},scope:this})},this)}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthProfilesController",{extend:"Ext.app.ViewController",alias:"controller.KAuthManager.AuthProfilesController",config:{listen:{global:{}},control:{"#":{select:function(a,b){Ext.globalEvents.fireEvent("AuthProfileSelected",b),"r"!==b.get("status")?(this.view.down("#authProfileDeleteButton").enable(),this.view.down("#authProfileActivateButton").setIcon("modules/KAuthProfiles/images/bulb_on.png"),this.view.down("#authProfileActivateButton").setTooltip("Activate Profile")):(this.view.down("#authProfileDeleteButton").disable(),this.view.down("#authProfileActivateButton").setIcon("modules/KAuthProfiles/images/bulb_off.png"),this.view.down("#authProfileActivateButton").setTooltip("Dectivate Profile"))},edit:function(a,b){b.record.save()}},"#profileFilter":{keyup:function(a,b){b.getKey()==b.ENTER&&(this.view.getStore().getProxy().extraParams.searchterm=a.getValue(),this.view.down("pagingtoolbar").moveFirst())}},"#authProfileActivateButton":{click:function(){this.view.up("#AuthProfileManagerPanel").showLoadMask();var a=this.view.getSelection();Ext.each(a,function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authprofiles/"+a.id+("r"===a.get("status")?"/deactivate":"/activate"),method:"POST",success:function(b,c){a.set("status","r"===a.get("status")?"d":"r"),Ext.globalEvents.fireEvent("AuthProfileStatusChange",a),this.view.up("#AuthProfileManagerPanel").hideLoadMask()},failure:function(a,b){this.view.up("#AuthProfileManagerPanel").hideLoadMask()},scope:this})},this)}},"#authProfileAddButton":{click:function(){Ext.Msg.prompt("Add Profile","Name of new Profile:",function(a,b){if("ok"==a){var c={id:SpiceCRM.KAuthManager.AuthProfileManager.Application.kGuid(),name:b,status:"d"};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authprofiles/"+c.id,method:"POST",jsonData:Ext.encode(c),success:function(a,b){var d=this.view.getStore().add(c);this.view.getStore().sort("name","ASC"),this.view.setSelection(d)},failure:function(a,b){},scope:this})}},this)}},"#authProfileDeleteButton":{click:function(){Ext.each(this.view.getSelection(),function(a){Ext.Ajax.request({url:"KREST/kauthprofiles/core/authprofiles/"+a.id,method:"DELETE",success:function(b,c){this.view.getStore().remove(a)},failure:function(a,b){},scope:this})},this),Ext.globalEvents.fireEvent("AuthProfileDeleted")}}}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.controller.MainController",{extend:"Ext.app.ViewController",alias:"controller.AuthProfileManager.main"}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.window.addfieldwindow",{extend:"Ext.window.Window",title:"Add Field",layout:"fit",width:500,height:300,closeAction:"close",plain:!0,draggable:!0,modal:!0,currentRecordId:void 0,items:[{xtype:"grid",itemId:"fieldGrid",store:{type:"AuthProfileManager.fields"},columns:[{text:"name",dataIndex:"name",flex:1,sortable:!0}]}],dockedItems:[{xtype:"toolbar",dock:"bottom",items:[{xtype:"displayfield",itemId:"messagecontainer"},"->",{text:"Cancel",handler:function(){this.up(".window").close()}},{text:"Add",handler:function(a){var b=a.up("window").down("grid"),c=b.getSelection();if(c.length>0){var d={kauthobject_id:this.up("window").currentRecordId,field:c[0].get("name"),control:"0"};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authobjects/fieldcontrol",method:"POST",jsonData:Ext.encode(d),success:function(a,b){Ext.data.StoreManager.lookup("KAuthManager.authobjectsfieldcontrols").add(d),this.up(".window").close()},failure:function(a,b){},scope:this})}else a.up("window").down("#messagecontainer").setValue("no field selected")}}]}],listeners:{show:function(){var a=this.down("#fieldGrid").getStore();a.removeAll(),a.getProxy().extraParams.authobjectid=this.currentRecordId,a.load()}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.window.addobjectwindow",{extend:"Ext.window.Window",title:"Add Object",layout:"fit",width:500,height:700,closeAction:"close",plain:!0,draggable:!0,modal:!0,currentRecordId:void 0,currentBean:void 0,items:[{xtype:"grid",itemId:"objectGrid",store:{type:"KAuthManager.authobjects",storeId:"KAuthManager.authprofileobjectsadd",autoLoad:!1},selModel:{type:"rowmodel",mode:"multi"},columns:[{text:"name",dataIndex:"name",flex:1,sortable:!0},{text:'<img src="modules/KAuthProfiles/images/bulb_on.png"/>',dataIndex:"status",width:40,align:"center",renderer:function(a){return"r"===a?'<img src="modules/KAuthProfiles/images/bulb_on.png"/>':'<img src="modules/KAuthProfiles/images/bulb_off.png"/>'}}],dockedItems:[{xtype:"pagingtoolbar",store:"KAuthManager.authprofileobjectsadd",dock:"bottom",displayInfo:!0}]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"combo",flex:1,itemId:"authTypeCombo",typeAhead:!0,triggerAction:"all",queryMode:"local",editable:!1,store:{type:"KAuthManager.authtypes"},displayField:"bean",valueField:"id",listeners:{select:function(a,b){var c=a.up("window").down("grid");c.getStore().removeAll(),c.getStore().getProxy().extraParams.kauthtypeid=b.id,c.getStore().load(),a.up("window").currentBean=b.get("bean")}}},{xtype:"textfield",flex:1,itemId:"authObjectFilter",enableKeyEvents:!0,listeners:{keyup:function(a,b){if(b.getKey()==b.ENTER){a.up("window").down("grid").getStore().getProxy().extraParams.searchterm=a.getValue(),a.up("window").down("pagingtoolbar").moveFirst()}}}}]},{xtype:"toolbar",dock:"bottom",items:[{xtype:"displayfield",itemId:"messagecontainer"},"->",{text:"Cancel",handler:function(){this.up(".window").close()}},{text:"Add",handler:function(a){var b=a.up("window").down("grid"),c=b.getSelection();c.length>0?(Ext.each(c,function(a){var b={id:a.get("id"),name:a.get("name"),status:a.get("status"),bean:this.up("window").currentBean};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authprofiles/"+this.up("window").currentRecordId+"/authobjects/"+a.get("id"),method:"POST",success:function(a,c){Ext.data.StoreManager.lookup("KAuthManager.authprofileobjects").add(b)},failure:function(a,b){},scope:this})},this),this.up(".window").close()):a.up("window").down("#messagecontainer").setValue("no Object selected")}}]}],listeners:{show:function(){var a=this.down("#objectGrid").getStore();a.removeAll(),a.getProxy().extraParams.authprofileid=this.currentRecordId}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.window.addprofilewindow",{extend:"Ext.window.Window",title:"Add Profile",layout:"fit",width:500,height:700,closeAction:"close",plain:!0,draggable:!0,modal:!0,currentUserId:void 0,items:[{xtype:"grid",store:{type:"KAuthManager.authprofiles",storeId:"KAuthManager.authprofilesadd",autoLoad:!1},selModel:{type:"rowmodel",mode:"multi"},columns:[{text:"name",dataIndex:"name",flex:1,sortable:!0},{text:'<img src="modules/KAuthProfiles/images/bulb_on.png"/>',dataIndex:"status",width:40,align:"center",renderer:function(a){return"r"===a?'<img src="modules/KAuthProfiles/images/bulb_on.png"/>':'<img src="modules/KAuthProfiles/images/bulb_off.png"/>'}}],dockedItems:[{xtype:"pagingtoolbar",store:"KAuthManager.authprofilesadd",dock:"bottom",displayInfo:!0}]}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",flex:1,itemId:"authProfileFilter",enableKeyEvents:!0,listeners:{keyup:function(a,b){if(b.getKey()==b.ENTER){a.up("window").down("grid").getStore().getProxy().extraParams.searchterm=a.getValue(),a.up("window").down("pagingtoolbar").moveFirst()}}}}]},{xtype:"toolbar",dock:"bottom",items:[{xtype:"displayfield",itemId:"messagecontainer"},"->",{text:"Cancel",handler:function(){this.up(".window").close()}},{text:"Add",handler:function(a){var b=a.up("window").down("grid"),c=b.getSelection();c.length>0?(Ext.each(c,function(a){var b={id:a.get("id"),name:a.get("name"),status:a.get("status")};Ext.Ajax.request({url:"KREST/kauthprofiles/core/authusers/"+this.up("window").currentUserId+"/authprofiles/"+a.get("id"),method:"POST",success:function(a,c){Ext.data.StoreManager.lookup("KAuthManager.authassignmentprofiles").add(b)},failure:function(a,b){},scope:this})},this),this.up(".window").close()):a.up("window").down("#messagecontainer").setValue("no Profile selected")}}]}],listeners:{show:function(){var a=this.down("grid").getStore();a.removeAll(),a.getProxy().extraParams.authuserid=this.currentUserId,a.load()}}}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthAssignmentProfiles",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthAssignmentProfiles",title:"Profiles",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthAssignmentProfilesController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthAssignmentProfilesController",layout:"fit",style:{"background-color":"transparent"},selModel:"rowmodel",store:{type:"KAuthManager.authprofiles",storeId:"KAuthManager.authassignmentprofiles",autoLoad:!1},columns:{defaults:{sortable:!1,menuDisabled:!0},items:[{text:"name",dataIndex:"name",flex:2,editor:{xtype:"textfield"}},{text:'<img src="modules/KAuthProfiles/images/bulb_on.png"/>',dataIndex:"status",width:40,align:"center",renderer:function(a){return"r"===a?'<img src="modules/KAuthProfiles/images/bulb_on.png"/>':'<img src="modules/KAuthProfiles/images/bulb_off.png"/>'}}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"authProfileAddButton",icon:"modules/KOrgObjects/images/add.png",tooltip:"add an Object",disabled:!0},{xtype:"button",itemId:"authProfileDeleteButton",disabled:!0,icon:"modules/KOrgObjects/images/delete.png",tooltip:"Delete the selected Object"}]}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthAssignmentUsers",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthAssignmentUsers",title:"Profiles",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthAssignmentUsersController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthAssignmentUsersController",layout:"fit",style:{"background-color":"transparent"},selModel:"rowmodel",plugins:{ptype:"cellediting",clicksToEdit:2},viewConfig:{markDirty:!1},store:Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.store.authassignmentusers",{storeId:"KAuthManager.authassignmentusers"}),columns:{defaults:{sortable:!1,menuDisabled:!0},items:[{text:"user name",dataIndex:"user_name",flex:2},{text:"first name",dataIndex:"first_name",flex:2},{text:"last name",dataIndex:"last_name",flex:2}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"userFilter",flex:1,enableKeyEvents:!0,emptyText:"filter users"}]},{xtype:"pagingtoolbar",store:"KAuthManager.authassignmentusers",dock:"bottom",displayInfo:!0}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthObjects",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthObjects",title:"Objects",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectsController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthObjectsController",layout:"fit",style:{"background-color":"transparent"},selModel:"rowmodel",plugins:{ptype:"cellediting",clicksToEdit:2},viewConfig:{markDirty:!1},store:Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjects",{storeId:"KAuthManager.authobjects"}),columns:{defaults:{sortable:!1,menuDisabled:!0},items:[{text:'<img src="modules/KAuthProfiles/images/lock.png"/>',dataIndex:"usagecount",width:40,align:"center",renderer:function(a){return a?'<img src="modules/KAuthProfiles/images/lock.png"/>':""}},{text:"name",dataIndex:"name",flex:2,editor:{xtype:"textfield"}},{text:'<img src="modules/KAuthProfiles/images/bulb_on.png"/>',dataIndex:"status",width:40,align:"center",renderer:function(a){return"r"===a?'<img src="modules/KAuthProfiles/images/bulb_on.png"/>':'<img src="modules/KAuthProfiles/images/bulb_off.png"/>'}},{text:'<img src="modules/KAuthProfiles/images/sql.png"/>',dataIndex:"customSQL",width:40,align:"center",renderer:function(a){return a&&""!==a?'<img src="modules/KAuthProfiles/images/sql.png"/>':""}},{text:'<img src="modules/KAuthProfiles/images/description.png"/>',dataIndex:"description",width:40,align:"center",renderer:function(a){return a&&""!==a?'<img src="modules/KAuthProfiles/images/description.png"/>':""}},{text:"type",dataIndex:"kauthobjecttype",flex:1,editor:{xtype:"combo",typeAhead:!0,triggerAction:"all",selectOnTab:!0,store:Ext.create("Ext.data.Store",{fields:["value","name"],data:[{value:"0",name:"standard"},{value:"1",name:"restrict (all)"},{value:"2",name:"exclude (all)"},{value:"3",name:"limit activity"},{value:"4",name:"restrict (profile)"},{value:"5",name:"exclude (profile)"}],storeId:"objectTypesStore"}),displayField:"name",valueField:"value",lazyRender:!0},renderer:function(a){var b=Ext.data.StoreManager.lookup("objectTypesStore"),c=b.findRecord("value",a);return c?c.get("name"):a}},{text:"activity",dataIndex:"activity",flex:1,editor:{xtype:"combo",typeAhead:!0,triggerAction:"all",selectOnTab:!0,store:Ext.create("Ext.data.Store",{fields:["value","name"],data:[{value:"0",name:"List"},{value:"1",name:"View"},{value:"2",name:"Edit"},{value:"3",name:"Create"},{value:"4",name:"Delete"},{value:"5",name:"*"}],storeId:"objectActivitiesStore"}),displayField:"name",valueField:"value",lazyRender:!0},renderer:function(a){var b=Ext.data.StoreManager.lookup("objectActivitiesStore"),c=b.findRecord("value",a);return c?c.get("name"):a}}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"combo",flex:1,itemId:"authTypeCombo",typeAhead:!0,triggerAction:"all",queryMode:"local",editable:!1,store:{type:"KAuthManager.authtypes",storeId:"KAuthManager.authtypes"},displayField:"bean",valueField:"id"},{xtype:"textfield",itemId:"objectFilter",flex:1,enableKeyEvents:!0,emptyText:"filter objects"},{xtype:"button",itemId:"authObjectActivateButton",icon:"modules/KOrgObjects/images/bulb_on.png",tooltip:"toggle Activation Status of the selected object"},{xtype:"button",itemId:"authObjectAddButton",icon:"modules/KOrgObjects/images/add.png",tooltip:"add an Object"},{xtype:"button",itemId:"authObjectDeleteButton",disabled:!0,icon:"modules/KOrgObjects/images/delete.png",tooltip:"Delete the selected Object"}]},{xtype:"pagingtoolbar",store:"KAuthManager.authobjects",dock:"bottom",displayInfo:!0}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthObjectsFieldControls",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthObjectsFieldControls",title:"Field Controls",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectFieldControlsController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthObjectFieldControlsController",layout:"fit",style:{"background-color":"transparent"},selModel:"rowmodel",plugins:{ptype:"cellediting",clicksToEdit:2},viewConfig:{markDirty:!1},store:Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjectfieldcontrols",{storeId:"KAuthManager.authobjectsfieldcontrols"}),columns:{defaults:{sortable:!1,menuDisabled:!0},items:[{text:"field",dataIndex:"field",flex:1},{text:"control",dataIndex:"control",flex:1,editor:{xtype:"combo",typeAhead:!0,triggerAction:"all",selectOnTab:!0,store:Ext.create("Ext.data.Store",{fields:["value","name"],data:[[0,"none"],[1,"hide"],[2,"display"],[3,"edit"]],storeId:"fieldControlStore"}),displayField:"name",valueField:"value",lazyRender:!0},renderer:function(a){var b=Ext.data.StoreManager.lookup("fieldControlStore"),c=b.findRecord("value",a);return c?c.get("name"):a}}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"authObjectFieldControlAddButton",icon:"modules/KOrgObjects/images/add.png",text:"Add"},{xtype:"button",itemId:"authObjectFieldControlDeleteButton",icon:"modules/KOrgObjects/images/delete.png",text:"delete"}]}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthObjectsFieldValues",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthObjectsFieldValues",title:"Field Values",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectFieldValuesController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthObjectFieldValuesController",layout:"fit",style:{"background-color":"transparent"},viewConfig:{markDirty:!1},selModel:"rowmodel",plugins:{ptype:"cellediting",clicksToEdit:2},store:Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjectfieldvalues",{storeId:"KAuthManager.authobjectsfieldvalues"}),columns:[{text:"name",dataIndex:"name",flex:1,menuDisabled:!0,sortable:!1},{text:"operator",dataIndex:"operator",flex:1,editor:{xtype:"combo",typeAhead:!0,triggerAction:"all",selectOnTab:!0,store:Ext.create("Ext.data.Store",{fields:["value","name"],data:[{value:"",name:"ignore"},{value:"EQ",
name:"="},{value:"NE",name:"≠"},{value:"IN",name:"in"},{value:"NI",name:"not in"},{value:"GT",name:">"},{value:"GTE",name:"≥"},{value:"LT",name:"<"},{value:"LTE",name:"≤"},{value:"LK",name:"like"}],storeId:"operatorTypesStore"}),displayField:"name",valueField:"value",lazyRender:!0},renderer:function(a){var b=Ext.data.StoreManager.lookup("operatorTypesStore"),c=b.findRecord("value",a);return c?c.get("name"):a},menuDisabled:!0,sortable:!1},{text:"value1",dataIndex:"value1",flex:1,menuDisabled:!0,sortable:!1},{text:"value2",dataIndex:"value2",flex:1,menuDisabled:!0,sortable:!1}],dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",text:"SQL"}]}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthObjectsOrgValues",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthObjectsOrgValues",title:"Org Values",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthObjectOrgValuesController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthObjectOrgValuesController",layout:"fit",style:{"background-color":"transparent"},viewConfig:{markDirty:!1},selModel:"rowmodel",plugins:{ptype:"cellediting",clicksToEdit:2},store:Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.store.authobjectorgvalues",{storeId:"KAuthManager.authobjectsorgvalues"}),columns:{defaults:{sortable:!1,menuDisabled:!0,flex:1},items:[{text:"name",dataIndex:"name"},{text:"value",dataIndex:"displayvalue",editor:{xtype:"textfield"}}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"combo",fieldLabel:"org assignment",itemId:"orgAssignment",value:"0",typeAhead:!0,triggerAction:"all",selectOnTab:!0,store:Ext.create("Ext.data.Store",{fields:["value","name"],data:[{value:"0",name:"own"},{value:"1",name:"all"},{value:"2",name:"relate"},{value:"3",name:"ignore"}]}),displayField:"name",valueField:"value",lazyRender:!0},{xtype:"checkbox",itemId:"assignedUser",fieldLabel:"assigned user"}]}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthProfileObjects",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthProfileObjects",title:"linked Objects",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthProfileObjectsController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthProfileObjectsController",layout:"fit",style:{"background-color":"transparent"},selModel:"rowmodel",store:Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.store.authprofileobjects",{storeId:"KAuthManager.authprofileobjects"}),columns:{defaults:{sortable:!1,menuDisabled:!0},items:[{text:"type",dataIndex:"bean",flex:2},{text:"name",dataIndex:"name",flex:2},{text:'<img src="modules/KAuthProfiles/images/bulb_on.png"/>',dataIndex:"status",width:40,align:"center",renderer:function(a){return"r"===a?'<img src="modules/KAuthProfiles/images/bulb_on.png"/>':'<img src="modules/KAuthProfiles/images/bulb_off.png"/>'}}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"button",itemId:"authProfilObjectAddButton",icon:"modules/KOrgObjects/images/add.png",tooltip:"add an Object",disabled:!0},{xtype:"button",itemId:"authProfileObjectDeleteButton",icon:"modules/KOrgObjects/images/delete.png",tooltip:"Delete the selected Object",disabled:!0}]}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.AuthProfiles",{extend:"Ext.grid.Panel",alias:"widget.KAuthManager.AuthProfiles",title:"Profiles",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.AuthProfilesController"],height:"100%",width:"100%",border:!1,controller:"KAuthManager.AuthProfilesController",layout:"fit",style:{"background-color":"transparent"},selModel:"rowmodel",plugins:{ptype:"cellediting",clicksToEdit:2},viewConfig:{markDirty:!1},store:Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.store.authprofiles",{storeId:"KAuthManager.authprofiles"}),columns:{defaults:{sortable:!1,menuDisabled:!0},items:[{text:'<img src="modules/KAuthProfiles/images/lock.png"/>',dataIndex:"usagecount",width:40,align:"center",renderer:function(a){return a?'<img src="modules/KAuthProfiles/images/lock.png"/>':""}},{text:"name",dataIndex:"name",flex:2,editor:{xtype:"textfield"}},{text:'<img src="modules/KAuthProfiles/images/bulb_on.png"/>',dataIndex:"status",width:40,align:"center",renderer:function(a){return"r"===a?'<img src="modules/KAuthProfiles/images/bulb_on.png"/>':'<img src="modules/KAuthProfiles/images/bulb_off.png"/>'}}]},dockedItems:[{xtype:"toolbar",dock:"top",items:[{xtype:"textfield",itemId:"profileFilter",flex:1,enableKeyEvents:!0,emptyText:"filter profiles"},{xtype:"button",itemId:"authProfileActivateButton",icon:"modules/KOrgObjects/images/bulb_on.png",tooltip:"toggle Activation Status of the selected object"},{xtype:"button",itemId:"authProfileAddButton",icon:"modules/KOrgObjects/images/add.png",tooltip:"add an Object"},{xtype:"button",itemId:"authProfileDeleteButton",disabled:!0,icon:"modules/KOrgObjects/images/delete.png",tooltip:"Delete the selected Object"}]},{xtype:"pagingtoolbar",store:"KAuthManager.authprofiles",dock:"bottom",displayInfo:!0}]}),Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.view.main.Main",{extend:"Ext.panel.Panel",requires:["SpiceCRM.KAuthManager.AuthProfileManager.controller.MainController"],xtype:"app-main",renderTo:"authprofilemanager",height:"100%",width:"100%",border:!1,controller:"AuthProfileManager.main",layout:"fit",itemId:"AuthProfileManagerPanel",loadMask:void 0,items:[{xtype:"tabpanel",width:"100%",items:[{xtype:"panel",title:"Auth Objects",layout:"hbox",items:[{xtype:"KAuthManager.AuthObjects",height:"100%",flex:2,border:!1,style:{"border-right":"1px solid rgb(208, 208, 208)"}},{xtype:"panel",height:"100%",flex:1,border:!1,layout:"vbox",items:[{xtype:"KAuthManager.AuthObjectsOrgValues",disabled:!0,width:"100%",flex:1},{xtype:"KAuthManager.AuthObjectsFieldValues",width:"100%",flex:1},{xtype:"KAuthManager.AuthObjectsFieldControls",width:"100%",disabled:!0,flex:1}]}]},{xtype:"panel",title:"Auth Profiles",layout:"hbox",items:[{xtype:"KAuthManager.AuthProfiles",height:"100%",flex:1,border:!1,style:{"border-right":"1px solid rgb(208, 208, 208)"}},{xtype:"KAuthManager.AuthProfileObjects",height:"100%",flex:1}]},{xtype:"panel",title:"Auth Assignment",height:"100%",layout:"hbox",items:[{xtype:"KAuthManager.AuthAssignmentUsers",height:"100%",flex:1,border:!1,style:{"border-right":"1px solid rgb(208, 208, 208)"}},{xtype:"KAuthManager.AuthAssignmentProfiles",height:"100%",flex:1}]}]}],showLoadMask:function(){this.loadMask||(this.loadMask=Ext.create("Ext.LoadMask",{target:this})),this.loadMask.show()},hideLoadMask:function(){this.loadMask.hide()}}),Ext.enableAriaButtons=!1,Ext.define("SpiceCRM.KAuthManager.AuthProfileManager.Application",{namespaces:["SpiceCRM.KAuthManager.AuthProfileManager"],controllers:["Application"],extend:"Ext.app.Application",name:"SpiceCRM.KAuthManager.AuthProfileManager",thisMainView:!1,launch:function(){SpiceCRM.KAuthManager.AuthProfileManager.Application=this,this.thisMainView&&this.destroyMainView(),this.render()},destroyMainView:function(){this.thisMainView.destroy(),this.thisMainView=!1},render:function(){this.thisMainView=Ext.create("SpiceCRM.KAuthManager.AuthProfileManager.view.main.Main"),Ext.get(window).on({resize:function(){SpiceCRM.KAuthManager.AuthProfileManager.Application.thisMainView&&SpiceCRM.KAuthManager.AuthProfileManager.Application.thisMainView.updateLayout()}})},languageGetText:function(a){return SUGAR.language.get("KAuthProfiles",a)},getRand:function(){return Math.random()},S4:function(){return(65536*(1+this.getRand())|0).toString(16).substring(1)},kGuid:function(){return"k"+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()+this.S4()}}),Ext.application({extend:"SpiceCRM.KAuthManager.AuthProfileManager.Application"});